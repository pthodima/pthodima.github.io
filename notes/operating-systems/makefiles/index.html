<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> The Art of Makefiles | Pavan Thodima </title> <meta name="author" content="Pavan C. Thodima"> <meta name="description" content="A comprehensive guide to understanding, writing, and mastering Makefiles."> <meta name="keywords" content="artificial-intelligence, machine-learning, computer-vision, game-theory, computer-systems, phd-applicant"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-material-light.css?0d497a695dd9d72224717abad2c1485a" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8E%93&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://pthodima.github.io/notes/operating-systems/makefiles/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-material-dark.css?ce81700c7ab241bd2f5051867d1493c0" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Pavan Thodima </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item active"> <a class="nav-link" href="/notes/">notes <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">The Art of Makefiles</h1> <p class="post-meta"> Created on December 17, 2025 </p> <p class="post-tags"> <i class="fa-solid fa-calendar fa-sm"></i> 2025   ·   <i class="fa-solid fa-tag fa-sm"></i> operating-systems </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>“Makefiles are the glue that holds your build system together.”</p> </blockquote> <h2 id="1-what-is-make">1. What is Make?</h2> <p>At its heart, <code class="language-plaintext highlighter-rouge">make</code> is a build automation tool that automatically builds executable programs and libraries from source code by reading files called <strong>Makefiles</strong>.</p> <p>Think of a Makefile as a <strong>Dependency Graph</strong> (specifically, a Directed Acyclic Graph or DAG). You tell <code class="language-plaintext highlighter-rouge">make</code>:</p> <ol> <li> <strong>What</strong> you want to build (the target).</li> <li> <strong>What</strong> files are needed to build it (the dependencies).</li> <li> <strong>How</strong> to build it (the recipe).</li> </ol> <p><code class="language-plaintext highlighter-rouge">make</code> is smart. It looks at the <strong>timestamps</strong> of your files. If a source file is newer than the target file that depends on it, <code class="language-plaintext highlighter-rouge">make</code> realizes the target is “stale” and runs the recipe to update it. If nothing changed, <code class="language-plaintext highlighter-rouge">make</code> does nothing. This incremental build process saves massive amounts of time.</p> <h2 id="2-anatomy-of-a-rule-docs">2. Anatomy of a Rule <a href="https://www.gnu.org/software/make/manual/html_node/Rule-Syntax.html" rel="external nofollow noopener" target="_blank">(docs)</a> </h2> <p>The fundamental building block of a Makefile is the <strong>rule</strong>:</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">target</span><span class="o">:</span> <span class="nf">prerequisites ...</span>
	recipe
	...
</code></pre></div></div> <ul> <li> <strong>Target</strong>: The name of the file you want to make (e.g., <code class="language-plaintext highlighter-rouge">main.o</code>, <code class="language-plaintext highlighter-rouge">app</code>).</li> <li> <strong>Prerequisites</strong>: The files that must exist <em>before</em> the target can be built.</li> <li> <strong>Recipe</strong>: The shell commands to create the target. <ul> <li> <strong>CRITICAL</strong>: You <strong>MUST</strong> indent recipes with a <strong>TAB</strong> character. Spaces will cause a syntax error.</li> </ul> </li> </ul> <h3 id="example">Example</h3> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hello</span><span class="o">:</span> <span class="nf">main.c</span>
	gcc main.c <span class="nt">-o</span> hello
</code></pre></div></div> <h2 id="3-variables-flavors-and-nuances-docs">3. Variables: Flavors and Nuances <a href="https://www.gnu.org/software/make/manual/html_node/Using-Variables.html" rel="external nofollow noopener" target="_blank">(docs)</a> </h2> <p>Variables in Makefiles (often called macros) come in two main flavors. Understanding the difference is crucial.</p> <h3 id="31-recursive-expansion-">3.1 Recursive Expansion (<code class="language-plaintext highlighter-rouge">=</code>)</h3> <p>The variable is expanded <em>every time</em> it is used.</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">FOO</span> <span class="o">=</span> <span class="p">$(</span>BAR<span class="p">)</span>
<span class="nv">BAR</span> <span class="o">=</span> hud
<span class="c"># When $(FOO) is used here, it expands to 'hud'
</span></code></pre></div></div> <h3 id="32-simply-expanded-">3.2 Simply Expanded (<code class="language-plaintext highlighter-rouge">:=</code>)</h3> <p>The variable is potentially expanded <em>once</em> when defined, and its value is fixed. <strong>Use this by default</strong> for predictable behavior, like in shell scripts.</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">:=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">:=</span> <span class="nt">-Wall</span> <span class="nt">-O2</span>
</code></pre></div></div> <h3 id="33-conditional-assignment-">3.3 Conditional Assignment (<code class="language-plaintext highlighter-rouge">?=</code>)</h3> <p>Assigns a value only if the variable is not already defined (e.g., by an environment variable).</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Use gcc only if CC is not already set in the environment
</span><span class="nv">CC</span> <span class="o">?=</span> gcc
</code></pre></div></div> <p><strong>Why is this useful?</strong> It makes your Makefile flexible and environment-aware. A user can compile with a different compiler without changing a single line of code, simply by running: <code class="language-plaintext highlighter-rouge">CC=clang make</code> If they don’t provide <code class="language-plaintext highlighter-rouge">CC</code>, it defaults to <code class="language-plaintext highlighter-rouge">gcc</code>.</p> <h3 id="34-append-">3.4 Append (<code class="language-plaintext highlighter-rouge">+=</code>)</h3> <p>Adds text to an existing variable.</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CFLAGS</span> <span class="o">:=</span> <span class="nt">-Wall</span>
<span class="nv">CFLAGS</span> <span class="o">+=</span> <span class="nt">-g</span>  <span class="c"># CFLAGS is now "-Wall -g"</span>
</code></pre></div></div> <h2 id="4-automatic-variables-docs">4. Automatic Variables <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html" rel="external nofollow noopener" target="_blank">(docs)</a> </h2> <p>These are special variables set by <code class="language-plaintext highlighter-rouge">make</code> for each rule. They are the key to writing concise rules.</p> <table> <thead> <tr> <th style="text-align: left">Variable</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$@</code></td> <td style="text-align: left">The file name of the <strong>target</strong> of the rule.</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$&lt;</code></td> <td style="text-align: left">The name of the <strong>first</strong> prerequisite.</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$^</code></td> <td style="text-align: left">The names of <strong>all</strong> the prerequisites, with spaces between them.</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$*</code></td> <td style="text-align: left">The stem with which an implicit rule matches.</td> </tr> </tbody> </table> <h3 id="usage-example">Usage Example</h3> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Instead of: gcc -c main.c -o main.o
</span><span class="nl">main.o</span><span class="o">:</span> <span class="nf">main.c</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nt">-c</span> <span class="nv">$&lt;</span> <span class="nt">-o</span> <span class="nv">$@</span>
</code></pre></div></div> <h2 id="5-phony-targets-docs">5. Phony Targets <a href="https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html" rel="external nofollow noopener" target="_blank">(docs)</a> </h2> <p>Not all targets represent files. <code class="language-plaintext highlighter-rouge">clean</code>, <code class="language-plaintext highlighter-rouge">install</code>, and <code class="language-plaintext highlighter-rouge">test</code> are <strong>actions</strong>. To prevent <code class="language-plaintext highlighter-rouge">make</code> from getting confused if a file named <code class="language-plaintext highlighter-rouge">clean</code> accidentally exists, declare it as <strong>.PHONY</strong>.</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean all install</span>

<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-f</span> <span class="k">*</span>.o myapp
</code></pre></div></div> <h2 id="6-pattern-rules-docs">6. Pattern Rules <a href="https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html" rel="external nofollow noopener" target="_blank">(docs)</a> </h2> <p>Don’t write a rule for every single <code class="language-plaintext highlighter-rouge">.c</code> file. Use <strong>Pattern Rules</strong> to teach <code class="language-plaintext highlighter-rouge">make</code> how to build <em>any</em> <code class="language-plaintext highlighter-rouge">.o</code> file from a <code class="language-plaintext highlighter-rouge">.c</code> file.</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># "To build any .o file from a .c file..."
</span><span class="nl">%.o</span><span class="o">:</span> <span class="nf">%.c</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nt">-c</span> <span class="nv">$&lt;</span> <span class="nt">-o</span> <span class="nv">$@</span>
</code></pre></div></div> <h2 id="7-useful-functions-docs">7. Useful Functions <a href="https://www.gnu.org/software/make/manual/html_node/Functions.html" rel="external nofollow noopener" target="_blank">(docs)</a> </h2> <p><code class="language-plaintext highlighter-rouge">make</code> has powerful built-in functions for text processing.</p> <ul> <li> <p><strong><code class="language-plaintext highlighter-rouge">wildcard</code></strong>: Get a list of files matching a pattern.</p> <div class="language-makefile highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nv">SRCS</span> <span class="o">:=</span> <span class="p">$(</span>wildcard <span class="k">*</span>.c<span class="p">)</span>  <span class="c"># explicit list: main.c utils.c</span>
</code></pre></div> </div> </li> <li> <p><strong><code class="language-plaintext highlighter-rouge">patsubst</code></strong>: Replace text matching a pattern.</p> <div class="language-makefile highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c"># Convert list of .c files to .o files
</span><span class="nv">OBJS</span> <span class="o">:=</span> <span class="p">$(</span>patsubst %.c,%.o,<span class="p">$(</span>SRCS<span class="p">))</span>
</code></pre></div> </div> </li> <li> <p><strong><code class="language-plaintext highlighter-rouge">shell</code></strong>: Run a shell command and capture output.</p> <div class="language-makefile highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nv">CURRENT_DATE</span> <span class="o">:=</span> <span class="p">$(</span>shell <span class="nb">date</span> +%Y-%m-%d<span class="p">)</span>
</code></pre></div> </div> </li> </ul> <h2 id="8-putting-it-all-together-a-pro-makefile">8. Putting it All Together: A Pro Makefile</h2> <p>Here is a robust, reusable template for C/C++ projects.</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">:=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">:=</span> <span class="nt">-Wall</span> <span class="nt">-Wextra</span> <span class="nt">-g</span>

<span class="c"># 1. Find all source files
</span><span class="nv">SRCS</span> <span class="o">:=</span> <span class="p">$(</span>wildcard <span class="k">*</span>.c<span class="p">)</span>

<span class="c"># 2. Define object files (smarter than listing manually)
</span><span class="nv">OBJS</span> <span class="o">:=</span> <span class="p">$(</span>SRCS:.c<span class="o">=</span>.o<span class="p">)</span>

<span class="c"># 3. Define the final executable
</span><span class="nv">TARGET</span> <span class="o">:=</span> my_program

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all clean</span>

<span class="nl">all</span><span class="o">:</span> <span class="nf">$(TARGET)</span>

<span class="c"># Link phase
</span><span class="nl">$(TARGET)</span><span class="o">:</span> <span class="nf">$(OBJS)</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nv">$^</span> <span class="nt">-o</span> <span class="nv">$@</span>

<span class="c"># Compile phase (Pattern Rule)
</span><span class="nl">%.o</span><span class="o">:</span> <span class="nf">%.c</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nt">-c</span> <span class="nv">$&lt;</span> <span class="nt">-o</span> <span class="nv">$@</span>

<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-f</span> <span class="p">$(</span>OBJS<span class="p">)</span> <span class="p">$(</span>TARGET<span class="p">)</span>
</code></pre></div></div> <h2 id="9-references--further-reading">9. References &amp; Further Reading</h2> <ul> <li> <a href="https://www.gnu.org/software/make/manual/make.html" rel="external nofollow noopener" target="_blank">GNU Make Manual</a> - The official bible.</li> <li> <a href="https://makefiletutorial.com/" rel="external nofollow noopener" target="_blank">Makefile Tutorial</a> - A friendly, example-driven introduction.</li> <li> <a href="https://cs.colby.edu/maxwell/courses/tutorials/maketutor/" rel="external nofollow noopener" target="_blank">A Trivial Makefile Tutorial</a> - Short and sweet.</li> </ul> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Pavan C. Thodima. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>